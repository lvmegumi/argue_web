<div class="comment mb-3 pb-3 border-bottom" data-created-at="{{ comment.created_at.isoformat() }}">
    <div class="d-flex align-items-center mb-2">
        <a href="/user/{{ comment.author.username }}">
            <img src="{{ comment.author.avatar }}" class="user-avatar me-2" alt="用户头像">
        </a>
        <div>
                <a href="/user/{{ comment.author.username }}" class="text-decoration-none {% if comment.faction == 'pro' %}text-success{% elif comment.faction == 'anti' %}text-danger{% else %}text-secondary{% endif %}">
                    {{ comment.author.username }}
                </a>
            <div class="text-muted small">{{ naturaltime(comment.created_at) }}</div>
        </div>
    </div>
    <div class="comment-content">
        {% if comment.content.startswith('论点:') and '\n\n论证:' in comment.content %}
            {# 处理论点论证格式的内容 #}
            {% set parts = comment.content.split('\n\n论证: ') %}
            {% set claim = parts[0] | replace('论点: ', '') %}
            {% set argument = parts[1] if parts|length > 1 else '' %}
            
            <div class="claim-argument-card">
                <div class="claim-section">
                    <div class="claim-header">
                        <i class="bi bi-lightning-charge-fill text-success me-2"></i>
                        <strong>论点</strong>
                    </div>
                    <div class="claim-content mt-2">
                        {{ claim | render_markdown_images | safe }}
                    </div>
                </div>
                
                {% if argument %}
                <div class="argument-section mt-3">
                    <div class="argument-header">
                        <i class="bi bi-chat-square-text-fill text-primary me-2"></i>
                        <strong>论证</strong>
                    </div>
                    <div class="argument-content mt-2">
                        {{ argument | render_markdown_images | safe }}
                    </div>
                </div>
                {% endif %}
            </div>
        {% elif comment.content.startswith('论点:') %}
            {# 只有论点 #}
            <div class="claim-section standalone">
                <div class="claim-header">
                    <i class="bi bi-lightning-charge-fill text-success me-2"></i>
                    <strong>论点</strong>
                </div>
                <div class="claim-content mt-2">
                    {{ comment.content | replace('论点: ', '') | render_markdown_images | safe }}
                </div>
            </div>
        {% elif comment.content.startswith('论证:') %}
            {# 只有论证 #}
            <div class="argument-section standalone">
                <div class="argument-header">
                    <i class="bi bi-chat-square-text-fill text-primary me-2"></i>
                    <strong>论证</strong>
                </div>
                <div class="argument-content mt-2">
                    {{ comment.content | replace('论证: ', '') | render_markdown_images | safe }}
                </div>
            </div>
        {% else %}
            {{ comment.content | render_markdown_images | safe }}
        {% endif %}
        
        <style>
            .comment-content img {
                max-width: 100%;
                height: auto;
                border-radius: 8px;
                margin: 10px 0;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }
            .comment-content video {
                max-width: 100%;
                border-radius: 8px;
                margin: 10px 0;
            }
            .comment-content iframe {
                max-width: 100%;
                margin: 10px 0;
            }
            
            /* 论点论证卡片样式 */
            .claim-argument-card {
                border: 1px solid #e0e0e0;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                background: linear-gradient(to bottom, #ffffff, #fafafa);
            }
            
            .claim-section {
                padding: 15px 20px;
                background-color: #f0f9f2;
                border-left: 4px solid #28a745;
            }
            
            .claim-section.standalone {
                border-radius: 8px;
                box-shadow: 0 2px 6px rgba(40, 167, 69, 0.1);
            }
            
            .argument-section {
                padding: 15px 20px;
                background-color: #f8f9fa;
                border-left: 4px solid #17a2b8;
            }
            
            .argument-section.standalone {
                border-radius: 8px;
                box-shadow: 0 2px 6px rgba(23, 162, 184, 0.1);
            }
            
            .claim-header, .argument-header {
                display: flex;
                align-items: center;
                padding-bottom: 8px;
                border-bottom: 1px dashed #ddd;
            }
            
            .claim-header strong, .argument-header strong {
                font-size: 1.1em;
            }
            
            .claim-content, .argument-content {
                padding-top: 8px;
            }
            
            .latex-formula {
                background-color: #f8f9fa;
                padding: 10px;
                border-radius: 4px;
                margin: 10px 0;
                font-family: monospace;
                overflow-x: auto;
            }
        </style>
    </div>
    <div class="comment-interactions mt-2">
        {% if current_user.is_authenticated %}
        <form method="POST" action="{{ url_for('comment_interaction', comment_id=comment.id, action='like') }}" class="d-inline interaction-form" data-action="like" data-type="comment">
            <button type="submit" class="btn btn-sm {% if current_user in comment.user_interactions|selectattr('liked')|map(attribute='user')|list %}btn-primary{% else %}btn-outline-primary{% endif %}">
                <i class="bi bi-hand-thumbs-up"></i> 支持 <span class="badge bg-light text-dark">{{ comment.like_count }}</span>
            </button>
        </form>
        <form method="POST" action="{{ url_for('comment_interaction', comment_id=comment.id, action='dislike') }}" class="d-inline ms-2 interaction-form" data-action="dislike" data-type="comment">
            <button type="submit" class="btn btn-sm {% if current_user in comment.user_interactions|selectattr('disliked')|map(attribute='user')|list %}btn-purple{% else %}btn-outline-purple{% endif %}">
                <i class="bi bi-hand-thumbs-down"></i> 反对 <span class="badge bg-light text-dark">{{ comment.dislike_count }}</span>
            </button>
        </form>
        {% else %}
        <button class="btn btn-sm btn-outline-secondary" disabled>
            <i class="bi bi-hand-thumbs-up"></i> 支持 <span class="badge bg-light text-dark">{{ comment.like_count }}</span>
        </button>
        <button class="btn btn-sm btn-outline-secondary" disabled>
            <i class="bi bi-hand-thumbs-down"></i> 反对 <span class="badge bg-light text-dark">{{ comment.dislike_count }}</span>
        </button>
        {% endif %}
    </div>
</div>